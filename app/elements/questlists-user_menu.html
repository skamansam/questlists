<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">

<dom-module id="questlists-userMenu">
<style include="shared-styles"></style>
<style>
  :host{
    height: 60px;
  }
  .menu-name {
    @apply(--paper-font-title);
    display: block;
    width: 170px;
    margin-top: 25px;
    padding-left: 65px;
  }
  .user-menu{
    float: right;
    width: 23px;
    margin-top: -55px;
  }
  .user_info .menu-name{
    margin-top: -40px;
  }
  .login_links .menu-name{
    float: none;
    width: 100%;
    margin-top: 15px;
    padding-left: 20px;
    cursor:pointer;
  }
  .avatar{
    padding: 0px;
    height: 50px;
    border: 1px solid #000;
    border-radius: 50%;
  }
  .avatar-small{
    padding: 0px;
    height: 30px;
    margin-right: 5px;
    border: 1px solid #000;
    border-radius: 50%;
    float: right;
  }
  .small-icons{
    float: right;
    height: 48%;
    width: 50%;
  }
  .hidden{
    display: none;
  }
  paper-item {
    --paper-item: {
      cursor: pointer;
      background-color: var(--drawer-background-color);
    };
  }

  </style>

  <template>
    <span class$="{{_user_info_class(user)}}">
      <img class='avatar' src='{{icon}}'/>
      <!--<div class='small-icons'>
        <img class='avatar-small' src='{{icon}}'/>
        <img class='avatar-small' src='{{icon}}'/>
      </div>-->
      <span class="menu-name">[[_compute_user_name(user)]]</span>
      <paper-dropdown-menu label="[[_compute_user_name(user)]]" class="user-menu">
        <paper-listbox class="dropdown-content" class="menu-name">
          <paper-item on-tap="logout">Log Out</paper-item>
        </paper-listbox>
      </paper-dropdown-menu>
    </span>
    <span class$="{{_login_links_class(user)}}">
      <span class="menu-name" on-tap="login">
          Log In / Sign Up
      </span>
    </span>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'questlists-userMenu',
    properties: {
      name: {
        type: String,
        value: 'unknown_user'
      },
      email: {
        type: String
      },
      icon: {
        type: String,
        value: '/images/unknown_user.svg'
      },
      auth: {
        type: Object
      },
      user:{
        type: Object
      }
    },
    observers: [
      '_set_with_gravatar(user.email)'
    ],
    login: function(){
      this.auth.login()
    },
    logout: function(){
      this.auth.logout()
    },
    _set_with_gravatar: function(email){
      if(!email)
        return
      console.log('setting gravatar: ', email)
      this.icon = "https://secure.gravatar.com/avatar/" + md5(email.toLowerCase().trim()) + "?size=50"
    },
    _compute_user_name: function(user){
      if(user != null)
        if (user.displayName != null)
          return user.displayName
        else if (user.email != null)
          return user.email.split('@')[0]
        else
          return "Anonymous"
      else {
        return "Not Logged In"
      }
    },
    _login_links_class: function(user){
      if(user == null || user == undefined)
        return "login_links"
      else
        return "login_links hidden"
    },
    _user_info_class: function(user){
      if(user != null || user != undefined)
        return "user_info"
      else
        return "user_info hidden"
    }
  });
</script>
