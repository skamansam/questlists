#!/bin/env sh

RED="\033[91m"
YELLOW="\033[93m"
GREEN="\033[92m"
RESET="\033[0m"

echo -n "Checking node version..."
if [[ `node --version` < v0.12 ]]; then
  echo -e "${RED}[FAILED]\nYour node version does not match! Upgrade to node > 0.12${RESET}";
  exit;
fi
echo -e "${GREEN}[ PASSED ]${RESET}"

echo -n "Checking for Gulp..."
RESULT=`gulp -v`
SUCCESS=$?
if [[ SUCCESS -ne 0 ]]; then
  echo -n "Installing..."
  RESULT=`npm install -g gulp`
  SUCCESS=$?
  if [[ SUCCESS -ne 0 ]]; then
    echo -e "${RED}[FAILED]\nThere was a problem installing gulp.\n Try installing it mannually:${RESET}";
    echo `echo RESULT > tail -n 100`
    exit;
  fi
fi
echo -e "${GREEN}[ PASSED ]${RESET}"

echo -n "Checking for Bower..."
RESULT=`bower -v`
SUCCESS=$?
if [[ SUCCESS -ne 0 ]]; then
  echo -n "Installing..."
  RESULT=`npm install -g bower`
  SUCCESS=$?
  if [[ SUCCESS -ne 0 ]]; then
    echo -e "${RED}[FAILED]\nThere was a problem installing bower.\n Try installing it mannually:${RESET}";
    echo `echo RESULT > tail -n 100`
    exit;
  fi
fi
echo -e "${GREEN}[ PASSED ]${RESET}"


echo -n "Installing Node modules..."
RESULT=`npm install`
SUCCESS=$?
if [[ SUCCESS -ne 0 ]]; then
  echo -e "${RED}[FAILED]\nThere was a problem installing Node modules.\n Try installing them mannually:${RESET}";
  echo `echo RESULT > tail -n 100`
  exit;
fi
echo -e "${GREEN}[ PASSED ]${RESET}"

echo -n "Installing Bower modules..."
RESULT=`bower install`
SUCCESS=$?
if [[ SUCCESS -ne 0 ]]; then
  echo -e "${RED}[FAILED]\nThere was a problem installing Bower modules.\n Try installing them mannually:${RESET}";
  echo `echo RESULT > tail -n 100`
  exit;
fi
echo -e "${GREEN}[ PASSED ]${RESET}"

echo -e "\n${GREEN}SUCCESS!\nRunning the server now so you can see your work!${RESET}"

exec ./bin/start
