<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">

<dom-module id="questlists-auth">
  <style include="shared-styles"></style>
  <style>
  </style>
  <template>
    <firebase-auth id="firebaseLogin" auth="{{auth}}" user="{{user}}" signed-in="{{signed_in}}" provider="[[provider]]" on-error="errorHandler">
    </firebase-auth>
    <firebase-document path='/users/{{user_id}}/info' data="{{user_data}}"></firebase-document>
    <paper-dialog id="loginDialog" modal on-iron-overlay-closed="_on_dialog_close">
      <h2>Login</h2>
      <form on-submit="_handle_password_login">
        <paper-input label="email" id="email" autocomplete="email" required></paper-input>
        <paper-input type="password" label="password" id="password" autocomplete="password" required></paper-input>
        <div class='oauth-buttons'>
          <paper-button on-tap="_handle_github_login">Github</paper-button>
          <paper-button on-tap="_handle_google_login">Google</paper-button>
          <paper-button on-tap="_handle_facebook_login">Facebook</paper-button>
          <paper-button on-tap="_handle_twitter_login">Twitter</paper-button>
        </div>
        <div class="buttons">
          <paper-button dialog-dismiss>Cancel</paper-button>
          <paper-button type="submit" on-tap="_handle_password_login">Login</paper-button>
        </div>
      </form>
    </paper-dialog>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'questlists-auth',
    properties: {
      user: {
        type: Object,
        notify: true
      },
      user_id:{
        type: String,
        notify: true
      },
      logged_in:{
        type: Boolean,
        value: false,
        notify: true
      },
      fbInstance:{
        type: Object,
        notify: true
      },
    },
    login: function(){
      this.$.loginDialog.open()
    },
    logout: function(){
      this.$.firebaseLogin.signOut()
    },
    add_login: function(){
    },
    _handle_github_login: function(){
      this.provider='github'
      login()
    },
    _handle_password_login: function(event, results, c,d){
      this.provider='password'
      email = this.$.email.value
      pwd = this.$.password.value
      this.$.firebaseLogin.signInWithEmailAndPassword(email, pwd)
        .then(this.userSuccessHandler.call(this))
    },
    userSuccessHandler: function(response) {
      this.$.loginDialog.close()
    },
    errorHandler: function(e) {
      alert('Error: ' + e.detail.message)
    },
    _handle_github_login: function(event, results, c,d){
    },
    signInAnonymously: function(){
      if(this.user != undefined)
        return true
      this.$.firebaseLogin.signInAnonymously()
        .then(this.userSuccessHandler.call(this))
    }
  });
</script>
